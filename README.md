# Описание проекта TaskTracker

## Глава 1. Текущее состояние

### 1. Безопасность и авторизация

Для защиты доступа к API и ресурсам TaskTracker используется JWT (JSON Web Tokens) с разделением на два типа токенов:

* **Access Token (AT)**

    * Краткоживущий токен (обычно 5–15 минут).
    * Хранится в HTTP‑cookie с флагом `HttpOnly`.
    * Используется для авторизации каждого запроса к защищённым маршрутам.
    * Минимизирует риск компрометации: в случае перехвата срок действия ограничен.

* **Refresh Token (RT)**

    * Долгоживущий токен (обычно несколько дней или недель).
    * Тоже хранится в HTTP‑cookie `HttpOnly`.
    * Предназначен для получения нового Access Token без повторного ввода учётных данных.
    * Позволяет поддерживать «сеанс» пользовател-й без постоянной аутентификации.

**Механика работы**:

1. При входе (`/api/v1/auth/login`) сервер проверяет логин и пароль и выдаёт пару токенов (AT + RT) в двух cookie.
2. Браузер автоматически отправляет Access Token, хранящийся в HTTP‑cookie, при каждом запросе к защищённым маршрутам.
3. По истечении срока действия AT клиент автоматически делает запрос `/api/v1/auth/refresh`, передавая RT, и получает новый AT.
4. При выходе из системы (`/api/v1/auth/logout`) оба cookie очищаются.

**Маршруты авторизации**:

* `POST /api/v1/auth/login` — аутентификация по логину и паролю.
* `POST /api/v1/auth/refresh-token` — обновление Access Token по Refresh Token.
* `POST /api/v1/auth/logout` — выход и удаление токенов.

**Роли пользователей**:

* **ROLE\_ADMIN** — полные административные права: управление пользователями, проектами и настройками.
* **ROLE\_USER** — базовый доступ: создание и редактирование собственных проектов.

---

### 1. Проекты

* **Создать проект**
  `POST /api/v1/projects`
  Доступно всем зарегистрированным (**ROLE\_USER**, **ROLE\_ADMIN**).
* **Получить все проекты**
  `GET  /api/v1/projects`
  Возвращает список проектов, в которых пользователь участвует.
* **Получить проект по ID**
  `GET  /api/v1/projects/{id}`
  Доступно участникам проекта.
* **Удалить проект**
  `DELETE /api/v1/projects/{id}`
  Доступно владельцу проекта или **ROLE\_ADMIN**.

### 2. Задачи

* **Создать задачу**
  `POST /api/v1/tasks`
  Доступно участникам проекта.
* **Получить задачу по ID**
  `GET  /api/v1/tasks/{id}`
  Доступно участникам проекта.
* **Удалить задачу**
  `DELETE /api/v1/tasks/{id}`
  Доступно создателю задачи или владельцу проекта.
* **Получить все задачи проекта**
  `GET  /api/v1/tasks/project/{projectId}`
  Доступно участникам проекта.

### 3. Приглашения и участники (не реализованно)

* **Приглашение пользователя**
  `POST /api/v1/projects/{projectId}/invitations`
  Доступно владельцу проекта.
* **Получить список участников**
  `GET  /api/v1/projects/{projectId}/collaborators`
  Доступно участникам проекта.

### 4. Пользователи (ROLE\_ADMIN)

* **Получить всех пользователей**
  `GET /api/v1/users/all`
  Доступно только **ROLE\_ADMIN**.

### 5. Аутентификация и регистрация

* **Регистрация**
  `POST /api/v1/users/register`
  Открытый эндпоинт для создания нового пользователя.
* **Подтверждение регистрации**
  `GET  /api/v1/users/confirm/{code}`
  Открытый эндпоинт для активации аккаунта по коду.
* **Вход**
  `POST /api/v1/auth/login`
  Принимает e-mail и пароль, возвращает JWT в HTTP-only cookie.
* **Обновление токена**
  `POST /api/v1/auth/refresh-token`
  Принимает refresh token, возвращает новый access token.
* **Выход**
  `POST /api/v1/auth/logout`
  Инвалидирует токены и очищает cookie.

---

## CI/CD

![CI](https://github.com/<your-org>/<your-repo>/actions/workflows/gradle.yml/badge.svg)

Проект интегрирован с **GitHub Actions** для автоматической сборки, тестирования и статического анализа при каждом `push` в ветки `main`, `develop` и при открытии Pull Request.

### Workflow файл

Расположен по пути `.github/workflows/gradle.yml`. Триггерится на события:

* `push` в ветки `main`, `develop`
* `pull_request` к веткам `main`, `develop`

#### Основные шаги

1. **Checkout** — клонирование репозитория.
2. **Настройка JDK 17**:

   ```yaml
   - name: Set up JDK
     uses: actions/setup-java@v3
     with:
       distribution: 'temurin'
       java-version: 17
   ```
3. **Кеширование зависимостей Gradle**.
4. **Запуск MySQL** (для интеграционных тестов).
5. **Сборка и тесты**:

   ```bash
   ./gradlew clean build --info
   ```
---
